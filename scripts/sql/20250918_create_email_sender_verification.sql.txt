-- Persistência mínima para auditoria/reenvio de verificação de remetente
-- Tabela independente, sem FK obrigatória. Sem transações ou triggers para máxima compatibilidade.

CREATE TABLE IF NOT EXISTS email_sender_verification (
  id         BIGSERIAL PRIMARY KEY,
  clinic_id  TEXT        NOT NULL,
  email      TEXT        NOT NULL,
  status     TEXT        NOT NULL DEFAULT 'pending', -- 'pending' | 'verified' | 'expired' | 'cancelled' | 'bounced'
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE INDEX IF NOT EXISTS idx_esv_clinic_email ON email_sender_verification (clinic_id, lower(email));
CREATE INDEX IF NOT EXISTS idx_esv_created_at    ON email_sender_verification (created_at);
